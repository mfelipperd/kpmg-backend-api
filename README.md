# Company Management API - Teste Avaliativo KPMG

<p align="center">
  <img src="https://nestjs.com/img/logo-small.svg" width="120" alt="NestJS Logo" />
</p>

<p align="center">
  <strong>API para gerenciamento de empresas e destinat√°rios de e-mail</strong>
</p>

<p align="center">
  <em>üéØ Teste Avaliativo para Vaga de Desenvolvedor Pleno - KPMG</em>
</p>

<p align="center">
  <a href="https://nestjs.com/" target="_blank">NestJS</a> ‚Ä¢ 
  <a href="https://www.prisma.io/" target="_blank">Prisma</a> ‚Ä¢ 
  <a href="https://www.postgresql.org/" target="_blank">PostgreSQL</a> ‚Ä¢ 
  <a href="https://swagger.io/" target="_blank">Swagger</a>
</p>

---

## üìã √çndice

- [Sobre o Projeto](#sobre-o-projeto)
- [Tecnologias Utilizadas](#tecnologias-utilizadas)
- [Pr√©-requisitos](#pr√©-requisitos)
- [Instala√ß√£o e Configura√ß√£o](#instala√ß√£o-e-configura√ß√£o)
- [Executando o Projeto](#executando-o-projeto)
- [Documenta√ß√£o da API](#documenta√ß√£o-da-api)
- [Endpoints Dispon√≠veis](#endpoints-dispon√≠veis)
- [Estrutura do Banco de Dados](#estrutura-do-banco-de-dados)
- [Vari√°veis de Ambiente](#vari√°veis-de-ambiente)
- [Scripts Dispon√≠veis](#scripts-dispon√≠veis)
- [Testes](#testes)
- [Deploy](#deploy)

---

## üöÄ Sobre o Projeto

Esta √© uma API REST desenvolvida com NestJS para gerenciamento de empresas e destinat√°rios de e-mail. O sistema permite:

- ‚úÖ Cadastro e gerenciamento de empresas
- ‚úÖ Gest√£o de destinat√°rios de e-mail
- ‚úÖ Envio autom√°tico de e-mails de confirma√ß√£o
- ‚úÖ API totalmente documentada com Swagger
- ‚úÖ Valida√ß√£o de dados com class-validator
- ‚úÖ Banco de dados PostgreSQL com Prisma ORM

---

## üõ† Tecnologias Utilizadas

### Backend
- **[NestJS](https://nestjs.com/)** - Framework Node.js para aplica√ß√µes server-side
- **[TypeScript](https://www.typescriptlang.org/)** - Linguagem de programa√ß√£o
- **[Prisma](https://www.prisma.io/)** - ORM moderno para TypeScript e Node.js
- **[PostgreSQL](https://www.postgresql.org/)** - Banco de dados relacional
- **[Docker](https://www.docker.com/)** - Containeriza√ß√£o do banco de dados

### Documenta√ß√£o e Valida√ß√£o
- **[Swagger/OpenAPI](https://swagger.io/)** - Documenta√ß√£o interativa da API
- **[class-validator](https://github.com/typestack/class-validator)** - Valida√ß√£o de DTOs
- **[class-transformer](https://github.com/typestack/class-transformer)** - Transforma√ß√£o de objetos

### E-mail
- **[Nodemailer](https://nodemailer.com/)** - Envio de e-mails
- **[@nestjs-modules/mailer](https://github.com/nest-modules/mailer)** - M√≥dulo de e-mail para NestJS

---

## üìã Pr√©-requisitos

Antes de come√ßar, certifique-se de ter instalado:

- **[Node.js](https://nodejs.org/)** (vers√£o 18 ou superior)
- **[npm](https://www.npmjs.com/)** ou **[yarn](https://yarnpkg.com/)**
- **[Docker](https://www.docker.com/)** e **[Docker Compose](https://docs.docker.com/compose/)**
- **[Git](https://git-scm.com/)**

---

## üîß Instala√ß√£o e Configura√ß√£o

### 1. Clone o reposit√≥rio
```bash
git clone <url-do-repositorio>
cd backend
```

### 2. Instale as depend√™ncias
```bash
npm install
```

### 3. Configure as vari√°veis de ambiente
Crie um arquivo `.env` na raiz do projeto:
```bash
# Banco de dados
DATABASE_URL="postgresql://user:password@localhost:5432/companydb"

# E-mail (opcional - configure se quiser enviar e-mails)
EMAIL_USER=seu-email@gmail.com
EMAIL_PASS=sua-senha-de-app
```

#### üìß **Configura√ß√£o do Gmail (Opcional)**
Para enviar e-mails, voc√™ precisa configurar uma senha de app do Gmail:

1. **Ative a verifica√ß√£o em 2 etapas** na sua conta Google
2. **Gere uma senha de app**:
   - Acesse: https://myaccount.google.com/apppasswords
   - Selecione "E-mail" e "Outro (nome personalizado)"
   - Digite "Company API" e clique em "Gerar"
   - **Copie a senha gerada** (16 caracteres)
3. **Configure no `.env`**:
   ```bash
   EMAIL_USER=seu-email@gmail.com
   EMAIL_PASS=senha-de-app-gerada
   ```

### 4. Inicie o banco de dados
```bash
docker compose up -d
```

### 5. Execute as migra√ß√µes do Prisma
```bash
npx prisma migrate deploy
```

---

## üöÄ Executando o Projeto

### Desenvolvimento
```bash
npm run start:dev
```

### Produ√ß√£o
```bash
npm run build
npm run start:prod
```

### Debug
```bash
npm run start:debug
```

O servidor estar√° rodando em:
- **API**: http://localhost:8080
- **Swagger**: http://localhost:8080/api

---

## üìö Documenta√ß√£o da API

A documenta√ß√£o completa da API est√° dispon√≠vel atrav√©s do Swagger UI:

**üîó [Acesse a documenta√ß√£o interativa](http://localhost:8080/api)**

A documenta√ß√£o inclui:
- ‚úÖ Descri√ß√£o de todos os endpoints
- ‚úÖ Exemplos de requisi√ß√µes e respostas
- ‚úÖ Teste interativo dos endpoints
- ‚úÖ Esquemas dos DTOs
- ‚úÖ C√≥digos de status HTTP

---

## üîå Endpoints Dispon√≠veis

### Health Check (`/health`)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `GET` | `/health` | Verifica√ß√£o completa de sa√∫de da aplica√ß√£o |
| `GET` | `/health/simple` | Verifica√ß√£o simples de sa√∫de (ideal para load balancers) |
| `GET` | `/ping` | Verifica√ß√£o b√°sica se a aplica√ß√£o est√° respondendo |

### App (`/`)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `GET` | `/` | Informa√ß√µes de boas-vindas e links √∫teis |

### Companies (`/companies`)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/companies` | Criar uma nova empresa |
| `GET` | `/companies` | Listar todas as empresas |
| `GET` | `/companies/:id` | Buscar empresa por ID |
| `PATCH` | `/companies/:id` | Atualizar empresa |
| `DELETE` | `/companies/:id` | Deletar empresa |

### Emails (`/emails`)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/emails` | Adicionar destinat√°rio de e-mail |
| `GET` | `/emails` | Listar todos os destinat√°rios |
| `PATCH` | `/emails/:id` | Atualizar destinat√°rio |
| `DELETE` | `/emails/:id` | Deletar destinat√°rio |

### Exemplos de Uso

#### Health Check
```bash
# Verifica√ß√£o completa de sa√∫de
curl http://localhost:3000/health

# Verifica√ß√£o simples
curl http://localhost:3000/health/simple

# Ping
curl http://localhost:3000/ping
```

#### Informa√ß√µes da API
```bash
# Boas-vindas e informa√ß√µes
curl http://localhost:3000/
```

#### Criar uma empresa
```bash
curl -X POST http://localhost:8080/companies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Empresa Exemplo Ltda",
    "cnpj": "12345678000195",
    "tradeName": "Empresa Exemplo",
    "address": "Rua das Flores, 123 - Centro - S√£o Paulo/SP",
    "favorite": true
  }'
```

#### Listar empresas
```bash
curl http://localhost:8080/companies
```

#### Adicionar destinat√°rio de e-mail
```bash
curl -X POST http://localhost:8080/emails \
  -H "Content-Type: application/json" \
  -d '{
    "email": "usuario@exemplo.com",
    "active": true
  }'
```

---

## üóÑ Estrutura do Banco de Dados

### Tabela: Company
```sql
CREATE TABLE "Company" (
  "id" SERIAL PRIMARY KEY,
  "name" VARCHAR NOT NULL,
  "cnpj" VARCHAR UNIQUE NOT NULL,
  "tradeName" VARCHAR NOT NULL,
  "address" VARCHAR NOT NULL,
  "favorite" BOOLEAN DEFAULT false,
  "createdAt" TIMESTAMP DEFAULT NOW(),
  "updatedAt" TIMESTAMP DEFAULT NOW()
);
```

### Tabela: EmailRecipient
```sql
CREATE TABLE "EmailRecipient" (
  "id" SERIAL PRIMARY KEY,
  "email" VARCHAR UNIQUE NOT NULL,
  "active" BOOLEAN DEFAULT true,
  "createdAt" TIMESTAMP DEFAULT NOW(),
  "updatedAt" TIMESTAMP DEFAULT NOW()
);
```

---

## üîê Vari√°veis de Ambiente

| Vari√°vel | Descri√ß√£o | Obrigat√≥ria | Padr√£o |
|----------|-----------|-------------|---------|
| `DATABASE_URL` | URL de conex√£o com PostgreSQL | ‚úÖ | - |
| `PORT` | Porta do servidor | ‚ùå | 3000 |
| `MAIL_HOST` | Servidor SMTP | ‚ùå | - |
| `MAIL_PORT` | Porta do servidor SMTP | ‚ùå | - |
| `MAIL_USER` | Usu√°rio do e-mail | ‚ùå | - |
| `MAIL_PASS` | Senha do e-mail | ‚ùå | - |

---

## üìú Scripts Dispon√≠veis

```bash
# Desenvolvimento
npm run start:dev          # Inicia em modo watch
npm run start:debug        # Inicia em modo debug

# Produ√ß√£o
npm run build             # Compila o projeto
npm run start:prod        # Inicia em modo produ√ß√£o

# Testes
npm run test              # Executa testes unit√°rios
npm run test:watch        # Executa testes em modo watch
npm run test:cov          # Executa testes com coverage
npm run test:e2e          # Executa testes end-to-end

# Qualidade de c√≥digo
npm run lint              # Executa o linter
npm run format            # Formata o c√≥digo

# Banco de dados
npx prisma migrate dev    # Cria nova migra√ß√£o
npx prisma migrate deploy # Aplica migra√ß√µes
npx prisma generate       # Gera o cliente Prisma
npx prisma studio         # Abre o Prisma Studio

# Git e Docker
./setup-git.sh            # Configura Git com padr√µes sem√¢nticos
docker-compose up -d      # Inicia servi√ßos Docker
docker-compose down       # Para servi√ßos Docker
```

---

## üìù Padr√µes de Commit

Este projeto utiliza [Conventional Commits](https://www.conventionalcommits.org/) para padronizar as mensagens de commit.

### Configura√ß√£o Inicial

```bash
# Execute o script de configura√ß√£o
./setup-git.sh
```

### Tipos de Commit

| Tipo | Descri√ß√£o | Exemplo |
|------|-----------|---------|
| `feat` | Nova funcionalidade | `feat(company): add company validation` |
| `fix` | Corre√ß√£o de bug | `fix(auth): resolve JWT token issue` |
| `docs` | Documenta√ß√£o | `docs(api): update swagger docs` |
| `refactor` | Refatora√ß√£o | `refactor(email): simplify email service` |
| `test` | Testes | `test(company): add unit tests` |
| `chore` | Manuten√ß√£o | `chore(docker): update docker-compose` |

### Exemplos de Commits

```bash
# Nova funcionalidade
git commit -m "feat(company): add company registration endpoint"

# Corre√ß√£o de bug
git commit -m "fix(auth): resolve JWT token expiration issue"

# Documenta√ß√£o
git commit -m "docs(readme): add Docker setup instructions"

# Refatora√ß√£o
git commit -m "refactor(email): simplify email template service"
```

üìö **Documenta√ß√£o completa**: [CONVENTIONAL_COMMITS.md](CONVENTIONAL_COMMITS.md)

---

## üß™ Testes

### Executar todos os testes
```bash
npm run test
```

### Executar testes com coverage
```bash
npm run test:cov
```

### Executar testes end-to-end
```bash
npm run test:e2e
```

### Executar testes em modo watch
```bash
npm run test:watch
```

---

## üöÄ Deploy

### Docker
```bash
# Build da imagem
docker build -t company-api .

# Executar container
docker run -p 8080:8080 company-api
```

### Vari√°veis de ambiente para produ√ß√£o
```bash
DATABASE_URL="postgresql://user:password@host:5432/companydb"
PORT=8080
NODE_ENV=production
```

---

## üìÅ Estrutura do Projeto

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ company/           # M√≥dulo de empresas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/          # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ *.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ emails/           # M√≥dulo de e-mails
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.controller.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.service.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ *.module.ts
‚îÇ   ‚îú‚îÄ‚îÄ prisma/           # Configura√ß√£o do Prisma
‚îÇ   ‚îú‚îÄ‚îÄ app.module.ts
‚îÇ   ‚îî‚îÄ‚îÄ main.ts
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/       # Migra√ß√µes do banco
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma     # Schema do banco
‚îú‚îÄ‚îÄ test/                 # Testes e2e
‚îú‚îÄ‚îÄ docker-compose.yml    # Configura√ß√£o do Docker
‚îî‚îÄ‚îÄ package.json
```

---

## ü§ù Contribui√ß√£o

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

---

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

## üìû Suporte

Para d√∫vidas ou suporte, entre em contato:

- üìß E-mail: suporte@exemplo.com
- üí¨ Discord: [Servidor da Comunidade](https://discord.gg/nestjs)
- üìñ Documenta√ß√£o: [NestJS Docs](https://docs.nestjs.com/)

---

<p align="center">
  Feito com ‚ù§Ô∏è usando <a href="https://nestjs.com/">NestJS</a>
</p>
